# Hawakening Docker Game Server

## Concepts

### Game Client

Our docker image **does not ship with a bundled game client**.
There are 2 methods to provide the game client to the docker container.

1. Bind-mount a folder on the host containing an unpacked game client to the container
2. Provide a URL to the container to download the client archive from. It will be downloaded and unpacked automatically.

### Important paths

The following paths inside the container are some of the important paths you should know about

| Path                                        | Description                                              |
| ------------------------------------------- | -------------------------------------------------------- |
| `/root/.wine/drive_c/hawakening/client`     | Default path for the gameclient binary (not bundled)     |
| `/root/.wine/drive_c/hawakening/hawkenject` | Default path for the hawkenject binary (bundled)         |
| `/root/My\ Games/Hawken`                    | Path where generated gameclient config & logs are stored |

### Required configuration

The server can be configured through the use of environment variables (see full list below).

The bare minimum you need to provide are:

| Variable             | Description                      |
| -------------------- | -------------------------------- |
| `HAWKEN_SERVER_NAME` | The name of your Hawken server   |
| `HAWKEN_LOGIN`       | Login credentials for the server |
| `HAWKEN_PASSWORD`    | Password for the server login    |

> You can also provide the entire argument list at once by using the `HAWKEN_SERVER_ARGS` env variable, this ignores all other variables.
> This is not advised unless you know what you are doing, since you are required to provide ALL necessary parameters yourself.

## Running a server using `docker run`

> The following examples assume you have the game client unpacked at `./clients/CL142579` relatively from the directory you're running these commands.

### Minimum configuration

This will spinup a DM server

```
docker run --name hawakening-server \
  -v ./clients/CL142579:/root/.wine/drive_c/hawakening/client \
  -e HAWKEN_SERVER_NAME="Belgium-DM-1" \
  -e HAWKEN_LOGIN="gameserver_username" \
  -e HAWKEN_PASSWORD="gameserver_password" \
  -p 7777:7777/tcp \
  -p 7777:7777/udp \
  hawakening-game-server
```

### Different port

If you'd like to host your server on a different port, **you need to provide the `HAWKEN_PORT` environment variable as well**.
This is because the gameserver will register itself with the master server list and it needs to be able to communicate which port to use.

```
docker run --name hawakening-server \
  -v ./clients/CL142579:/root/.wine/drive_c/hawakening/client \
  -e HAWKEN_SERVER_NAME="Belgium-TDM-1" \
  -e HAWKEN_LOGIN="gameserver_username" \
  -e HAWKEN_PASSWORD="gameserver_password" \
  -e HAWKEN_GAME_MODE="TDM" \
  -e HAWKEN_PORT="7900" \
  -p 7900:7900/tcp \
  -p 7900:7900/udp \
  hawakening-game-server
```

### Custom hook.dll

We will publish new images for every hook update (to make updating servers easy), but if for some reason you'd like to run a custom `hook.dll` you can do so by bind-mounting it from the host system to the docker container.

```
docker run --name hawakening-server \
  -v ./clients/CL142579:/root/.wine/drive_c/hawakening/client \
  -v ./hawkenject/hook.dll:/root/.wine/drive_c/hawakening/hawkenject/hook.dll \
  -e HAWKEN_SERVER_NAME="Belgium-TDM-1" \
  -e HAWKEN_LOGIN="gameserver_username" \
  -e HAWKEN_PASSWORD="gameserver_password" \
  -e HAWKEN_GAME_MODE="TDM" \
  -p 7777:7777/tcp \
  -p 7777:7777/udp \
  hawakening-game-server
```

### Bind-mount `My Games/Hawken` directory for logs & ini access

Sometimes you'd like to be able to access the ini files generated by the game, or the logs. This is how you can make them available on the host system for inspection.

```
docker run --name hawakening-server \
  -v ./clients/CL142579:/root/.wine/drive_c/hawakening/client \
  -v ./Hawken:/root/My\ Games/Hawken \
  -e HAWKEN_SERVER_NAME="Belgium-TDM-1" \
  -e HAWKEN_LOGIN="gameserver_username" \
  -e HAWKEN_PASSWORD="gameserver_password" \
  -e HAWKEN_GAME_MODE="TDM" \
  -p 7777:7777/tcp \
  -p 7777:7777/udp \
  hawakening-game-server
```

## Environment Variables

This Dockerfile uses several environment variables to configure the Hawken server.

### Required Environment Variables

These variables must be set in order for the server to work:

| Variable             | Description                      |
| -------------------- | -------------------------------- |
| `HAWKEN_SERVER_NAME` | The name of your Hawken server   |
| `HAWKEN_LOGIN`       | Login credentials for the server |
| `HAWKEN_PASSWORD`    | Password for the server login    |

### Optional Environment Variables with Defaults

These variables have default values but can be overridden:

| Variable                        | Description                                                                 | Default Value                    |
| ------------------------------- | --------------------------------------------------------------------------- | -------------------------------- |
| `HAWKEN_ROOT_DIR`               | Root directory for Hawken                                                   | `/root/.wine/drive_c/hawakening` |
| `HAWKEN_ClIENT_DIR`             | Game client directory                                                       | `${HAWKEN_ROOT_DIR}/client`      |
| `HAWKEN_INJECTOR_DIR`           | Hawkenject directory                                                        | `${HAWKEN_ROOT_DIR}/hawkenject`  |
| `HAWKEN_CLIENT_URL`             | URL to download game client archive (7z)                                    | `undefined`                      |
| `HAWKEN_MAP`                    | Map to use                                                                  | `VS-Wreckage`                    |
| `HAWKEN_GAME_MODE`              | Game mode                                                                   | `DM`                             |
| `HAWKEN_MIN_PLAYERS`            | Minimum number of players                                                   | `1`                              |
| `HAWKEN_MAX_PLAYERS`            | Maximum number of players                                                   | `undefined`                      |
| `HAWKEN_IGNORE_MMR`             | Whether to ignore MMR                                                       | `False`                          |
| `HAWKEN_SHOULD_ADVERTISE`       | Whether the server should advertise itself                                  | `True`                           |
| `HAWKEN_IS_MATCHMAKING_VISIBLE` | Visibility in matchmaking                                                   | `True`                           |
| `HAWKEN_PORT`                   | Server port                                                                 | `7777`                           |
| `HAWKEN_BEACON_PORT`            | PartyBeacon port(reservation)                                               | `${HAWKEN_PORT}`                 |
| `HAWKEN_SERVER_ENDPOINT`        | Server endpoint, if not provided, we will try and retrieve it based on curl | `$(curl ifconfig.me/ip)`         |
| `HAWKEN_SERVER_REGION`          | Server region                                                               | `Europe`                         |
| `HAWKEN_LOG_FILE`               | Log file name                                                               | `hwkn_server.log`                |
| `HAWKEN_TICK_RATE`              | Network tick rate                                                           | `90`                             |

### Custom Server Arguments

| Variable               | Description                                                                                                                        |
| ---------------------- | ---------------------------------------------------------------------------------------------------------------------------------- |
| `HAWKEN_EXTRA_ARGS`    | If set, these will be appended to existing arguments.                                                                              |
| `HAWKEN_OVERRIDE_ARGS` | If set, this will override all individual server argument settings. Use this to provide a custom, complete server argument string. |

## TODO

- [ ] Fetch hook.dll / hawkenject.exe from github release or webserver on startup (pin version?)
- [ ] Add AdminPassword environment variable
